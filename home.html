<div dir="rtl" lang="ar">
<style>
/* â€”â€”â€” Ø§Ù„Ø®Ø·ÙˆØ· â€”â€”â€” */
@font-face{
  font-family:'Saudi';
  src:url('/wp-content/uploads/2025/08/Saudi-Regular1.ttf') format('truetype');
  font-weight:400; font-style:normal; font-display:swap;
}
@font-face{
  font-family:'Saudi';
  src:url('/wp-content/uploads/2025/08/Saudi-Bold2.ttf') format('truetype');
  font-weight:700; font-style:normal; font-display:swap;
}
*,*::before,*::after{ box-sizing:border-box }
:where(html, body, .wrap, #sa-map *, #map-note, #quiz-box, #quiz-box *){
  font-family:'Saudi', Tahoma, Arial, sans-serif !important;
}
body{ margin:0; background:#003D42; color:#0f172a }

/* Ø²Ø®Ø±ÙØ© Ø£Ø¹Ù„Ù‰/Ø£Ø³ÙÙ„ (ÙƒÙ…Ø§ Ù‡ÙŠ) */
.pattern{ width:100%; height:60px; background:url('http://ksa-national-day-quiz.local/wp-content/uploads/2025/08/Screenshot-2025-08-22-004929.png') repeat-x center / auto 100%; display:block; line-height:0; margin:0 !important; }

/* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
.wrap{ padding:0 min(3vw,28px) min(3vw,28px); min-height:calc(100vh - 120px); background:#003D42; display:flex; flex-direction:column; align-items:center; }
.logo{ display:block; width:clamp(280px,36vw,460px); height:auto; margin:-70px auto -20px !important; filter:drop-shadow(0 6px 14px rgba(0,0,0,.22)); }

/* Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
#map-note{
  display:inline-block; border:1px solid #e5e7eb; border-radius:12px;
  padding:.6rem .75rem; background:#fff; color:#111827; font-size:15px;
  max-width:min(100%,1100px); margin-bottom:12px;
}

/* â€”â€”â€” Ø®Ø±ÙŠØ·Ø© Ø¨Ø¯ÙˆÙ† Ø¥Ø·Ø§Ø± â€”â€”â€” */
#sa-map{
  /* Ø¥ØµÙ„Ø§Ø­: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø·Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ */
  background:transparent !important;
  padding:0 !important;
  border-radius:0 !important;
  box-shadow:none !important;
  width:100%; max-width:1100px; overflow:visible; touch-action:manipulation; user-select:none;
}

/* SVG Ù…Ø±Ù† */
#sa-map svg{ width:100% !important; height:auto !important; background:transparent !important; }

/* ØªØ³Ù…ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ */
#sa-map svg text.region-label{
  fill:#000; font-weight:700; pointer-events:none; text-rendering:geometricPrecision;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* Ø§Ù†ØªÙ‚Ø§Ù„ Ù†Ø§Ø¹Ù… */
#sa-map svg path{ transition:fill .2s ease, stroke .2s ease, filter .15s ease; }

/* Ø­Ø¯ÙˆØ¯ ÙˆØ§Ø¶Ø­Ø© + Ø¸Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù†ÙØ³Ù‡Ø§ */
#sa-map svg path{
  /* Ø¥ØµÙ„Ø§Ø­: Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø£Ø¨ÙŠØ¶ ÙˆØ­Ø¯ÙˆØ¯ Ø«Ø§Ø¨ØªØ© Ù„Ø§ ØªØªØ£Ø«Ø± Ø¨Ø§Ù„ØªÙƒØ¨ÙŠØ± */
  fill:#ffffff;
  stroke:#2b3a3a;
  stroke-width:0.9;
  vector-effect:non-scaling-stroke; /* ØªØ«Ø¨ÙŠØª Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø­Ø¯ */
  filter:drop-shadow(0 1px 1px rgba(0,0,0,.35)); /* Ø¸Ù„ ÙŠØªØ¨Ø¹ Ø´ÙƒÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© */
}

@media (max-width:640px){
  #map-note{ font-size:14px; padding:.55rem .7rem }
}
</style>

<!-- Ø²Ø®Ø±ÙØ© Ø¹Ù„ÙˆÙŠØ© -->
<div class="pattern" aria-hidden="true"></div>

<div class="wrap">
  <img class="logo" src="http://ksa-national-day-quiz.local/wp-content/uploads/2025/08/Ù„ÙˆÙ‚Ùˆ-ÙŠÙˆÙ…-Ø§Ù„ÙˆØ·Ù†ÙŠ-95-scaled.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ 95">
  <div id="map-note">Ø§Ø®ØªØ± Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„.</div>
  <div id="sa-map"></div>
</div>

<!-- Ø²Ø®Ø±ÙØ© Ø³ÙÙ„ÙŠØ© -->
<div class="pattern" aria-hidden="true"></div>



<script>
(async () => {
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ SVG
  const res       = await fetch('/wp-content/uploads/2025/08/sa.svg');
  const svgText   = await res.text();
  const container = document.getElementById('sa-map');
  container.innerHTML = svgText;

  const svg = container.querySelector('svg');
  if (!svg) return;

  // ØªØ¬Ø§ÙˆØ¨
  svg.style.width='100%';
  svg.style.height='auto';
  svg.style.background='transparent';
  svg.setAttribute('preserveAspectRatio','xMidYMid meet');

  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø®Ù„ÙÙŠØ© Ø¯Ø§Ø®Ù„ Ù…Ù„Ù SVG
  svg.querySelectorAll('rect').forEach(r=>{ r.setAttribute('fill','transparent'); r.setAttribute('stroke','none'); });

  const note = document.getElementById('map-note');

  // ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¨Ø± ?ndqTest=1
  const isTest = new URLSearchParams(location.search).has('ndqTest');

  // Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„ØªØ³Ù…ÙŠØ§Øª
  const arabicLabels = {
    'Ar Riyad':'Ø§Ù„Ø±ÙŠØ§Ø¶','Makkah':'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','`Asir':'Ø¹Ø³ÙŠØ±','Jizan':'Ø¬Ø§Ø²Ø§Ù†','Najran':'Ù†Ø¬Ø±Ø§Ù†',
    'Al Madinah':'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Al Quassim':'Ø§Ù„Ù‚ØµÙŠÙ…','Tabuk':'ØªØ¨ÙˆÙƒ','Al Hudud ash Shamaliyah':'Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©',
    'Ash Sharqiyah':'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©','Al Jawf':'Ø§Ù„Ø¬ÙˆÙ',"Ha'il":'Ø­Ø§Ø¦Ù„','Al Bahah':'Ø§Ù„Ø¨Ø§Ø­Ø©'
  };

  // ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù…ÙˆØ§Ø¶Ø¹ ØªØ³Ù…ÙŠØ§Øª
  const labelAdjust = {
    'Al Quassim':{sizeAdd:8}, 'Ar Riyad':{sizeAdd:8}, 'Ash Sharqiyah':{sizeAdd:2},
    'Makkah':{sizeAdd:8}, 'Al Madinah':{sizeAdd:5}, 'Najran':{sizeAdd:8}, '`Asir':{sizeAdd:8},
    "Ha'il":{sizeAdd:4}, 'Al Bahah':{sizeAdd:4}, 'Tabuk':{sizeAdd:4, dy:-60},
    'Al Hudud ash Shamaliyah':{dy:-35, rotate:-320}, 'Jizan':{sizeAdd:4, dy:-10, rotate:-350}
  };

  // Ø£Ø³Ø¦Ù„Ø©
  const regionQuiz = {
    'Ar Riyad': { q:'Ù…Ø§ Ù‡ÙŠ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©ØŸ', choices:['Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©','Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©'], correct:1 },
    'Makkah': { q:'ÙŠÙˆØ¬Ø¯ ÙÙŠ Ù…ÙƒØ© Ø£Ù‚Ø¯Ø³ Ù…Ø³Ø¬Ø¯ ÙÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… ÙˆÙ‡Ùˆ:', choices:['Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø­Ø±Ø§Ù…','Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ','Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰','Ù…Ø³Ø¬Ø¯ Ù‚Ø¨Ø§Ø¡'], correct:0 },
    '`Asir': { q:'ØªÙ‚Ø¹ Ù…Ù†Ø·Ù‚Ø© Ø¹Ø³ÙŠØ± ÙÙŠ Ø£ÙŠ Ø¬Ù‡Ø© Ù…Ù† Ø§Ù„Ù…Ù…Ù„ÙƒØ©ØŸ', choices:['Ø§Ù„Ø´Ù…Ø§Ù„','Ø§Ù„Ø¬Ù†ÙˆØ¨ Ø§Ù„ØºØ±Ø¨ÙŠ','Ø§Ù„Ø´Ø±Ù‚','Ø§Ù„ÙˆØ³Ø·'], correct:1 },
    'Jizan': { q:'Ø¬Ø§Ø²Ø§Ù† ØªØ´ØªÙ‡Ø± Ø¨Ø¬Ø²Ø±Ù‡Ø§ ÙˆÙ…Ù† Ø£Ø´Ù‡Ø±Ù‡Ø§:', choices:['ÙØ±Ø³Ø§Ù†','Ø£Ø¨Ùˆ Ø¹Ù„ÙŠ','ØªØ§Ø±ÙˆØª','Ø§Ù„Ø³Ø§ÙÙ„ÙŠÙ†'], correct:0 },
    'Najran': { q:'Ù†Ø¬Ø±Ø§Ù† ØªÙ‚Ø¹ Ø¹Ù„Ù‰ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù…Ø¹:', choices:['Ø§Ù„Ø£Ø±Ø¯Ù†','Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª','Ø§Ù„ÙŠÙ…Ù†','Ø§Ù„ÙƒÙˆÙŠØª'], correct:2 },
    'Al Madinah': { q:'Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ù†Ø¨ÙˆÙŠ ÙŠÙ‚Ø¹ ÙÙŠ:', choices:['Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø¯Ø©','Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©','Ø§Ù„Ø¯Ù…Ø§Ù…'], correct:2 },
    'Al Quassim': { q:'ØªØ´ØªÙ‡Ø± Ø§Ù„Ù‚ØµÙŠÙ… Ø¨Ø²Ø±Ø§Ø¹Ø©:', choices:['Ø§Ù„Ù‚Ù…Ø­','Ø§Ù„ØªÙ…Ø±','Ø§Ù„Ø£Ø±Ø²','Ø§Ù„Ù‚Ø·Ù†'], correct:1 },
    'Tabuk': { q:'Ù…Ø¯ÙŠÙ†Ø© Ù†ÙŠÙˆÙ… ØªÙ‚Ø¹ Ø¥Ø¯Ø§Ø±ÙŠØ§Ù‹ Ø¶Ù…Ù† Ù…Ù†Ø·Ù‚Ø©:', choices:['ØªØ¨ÙˆÙƒ','Ø­Ø§Ø¦Ù„','Ø§Ù„Ø´Ø±Ù‚ÙŠØ©','Ø§Ù„Ø¬ÙˆÙ'], correct:0 },
    'Al Hudud ash Shamaliyah': { q:'ØªÙ‚Ø¹ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ© ÙÙŠ Ø£Ù‚ØµÙ‰:', choices:['Ø§Ù„Ø´Ø±Ù‚','Ø§Ù„ØºØ±Ø¨','Ø§Ù„Ø´Ù…Ø§Ù„','Ø§Ù„Ø¬Ù†ÙˆØ¨'], correct:2 },
    'Ash Sharqiyah': { q:'Ø£ÙƒØ¨Ø± Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ù…Ø³Ø§Ø­Ø© Ù‡ÙŠ:', choices:['Ø§Ù„Ø´Ø±Ù‚ÙŠØ©','Ø§Ù„Ø±ÙŠØ§Ø¶','Ù…ÙƒØ©','Ø¹Ø³ÙŠØ±'], correct:0 },
    'Al Jawf': { q:'Ù…Ù† ÙˆØ§Ø­Ø§Øª Ø§Ù„Ø´Ù…Ø§Ù„ Ø§Ù„Ø´Ù‡ÙŠØ±Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆÙ:', choices:['Ø¯ÙˆÙ…Ø© Ø§Ù„Ø¬Ù†Ø¯Ù„','Ø§Ù„Ø·Ø§Ø¦Ù','Ø³ÙƒØ§ÙƒØ§','ÙŠÙ†Ø¨Ø¹'], correct:0 },
    "Ha'il": { q:'ÙŠØ´ØªÙ‡Ø± ØªØ±Ø§Ø« Ø­Ø§Ø¦Ù„ Ø¨Ù…Ø³Ø§Ø¨Ù‚Ø©:', choices:['Ø§Ù„Ù‡Ø¬Ù†','Ø§Ù„Ø®ÙŠÙ„','Ø§Ù„ØªØ¬Ø¯ÙŠÙ','Ø§Ù„ØºÙˆØµ'], correct:0 },
    'Al Bahah': { q:'Ù‚Ø±ÙŠØ© Ø°ÙŠ Ø¹ÙŠÙ† Ø§Ù„Ø£Ø«Ø±ÙŠØ© ØªÙ‚Ø¹ ÙÙŠ:', choices:['Ø§Ù„Ø·Ø§Ø¦Ù','Ø§Ù„Ø¨Ø§Ø­Ø©','Ø§Ù„Ø±ÙŠØ§Ø¶','Ø¬Ø§Ø²Ø§Ù†'], correct:1 }
  };

  // Ø£Ù„ÙˆØ§Ù†
  const HOVER_FILL  = '#d1d5db';
  const RIGHT_COLOR = '#16a34a';
  const WRONG_COLOR = '#dc2626';

  // Ø­Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø±/Ù‚ÙÙ„
  let picked = false;
  let pickedRegionKey = null;
  let hardLocked = false;

  // Ù…Ø³Ø§Ø¹Ø¯Ø§Øª
  const group = container.querySelector('#features') || container;
  const paths = group.querySelectorAll('path');

  // ÙØ±Ø¶ Ø§Ù„Ø£Ø¨ÙŠØ¶ ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„Ø¸Ù„ (Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù†Ù‚Ø±)
  paths.forEach(p=>{
    p.setAttribute('fill','#ffffff');
    p.setAttribute('stroke','#2b3a3a');
    p.setAttribute('stroke-width','0.9');
    p.setAttribute('vector-effect','non-scaling-stroke');
    p.style.filter='drop-shadow(0 1px 1px rgba(0,0,0,.35))';
  });

  // ØªÙ„ÙˆÙŠÙ† ÙƒÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  function paintAll(color){
    paths.forEach(p=>{ p.style.fill=color; p.setAttribute('fill',color); });
  }

  // Ù‚ÙÙ„ Ù†Ù‡Ø§Ø¦ÙŠ
  function lockAll(){
    hardLocked = true;
    paths.forEach(p=>{ p.style.pointerEvents='none'; p.style.cursor='default'; });
    try{ localStorage.setItem('ndq-answered-once','1'); }catch(_){}
  }

  // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© (Ù„ÙˆÙ† + Ø±Ø³Ø§Ù„Ø©) Ø¥Ù† ÙˆÙØ¬Ø¯Øª
  try{
    if (localStorage.getItem('ndq-answered-once') === '1'){
      const savedColor = localStorage.getItem('ndq-result-color');
      const savedNote  = localStorage.getItem('ndq-finish-note');
      if (savedColor) paintAll(savedColor);
      lockAll();
      note.innerHTML = savedNote || `
        <div style="font-weight:700;margin-bottom:6px">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ù…Ø³Ø¨Ù‚Ù‹Ø§ âœ…</div>
        <div>Ø´ÙƒØ±Ù‹Ø§ Ù„ØªÙØ§Ø¹Ù„Ùƒ! ØªØ§Ø¨Ø¹ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ø¹Ø¨Ø± Ø¹Ù…Ø§Ø¯Ø© Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨.</div>
      `;
    } else {
      note.textContent = 'Ø§Ø®ØªØ± Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„.';
    }
  }catch(_){ note.textContent = 'Ø§Ø®ØªØ± Ø£ÙŠ Ù…Ù†Ø·Ù‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„.'; }

  // Ø·Ø¨Ù‚Ø© ØªØ³Ù…ÙŠØ§Øª
  const labelLayer = document.createElementNS('http://www.w3.org/2000/svg','g');
  svg.appendChild(labelLayer);

  // Ø¯Ø§Ù„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù† Ø®ØµØ§Ø¦Øµ Ù…ØªØ¹Ø¯Ø¯Ø© (Ù„ØªÙØ§Ø¯ÙŠ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ù†Ù‚Ø±)
  const getKey = el => (el.getAttribute('name') || el.getAttribute('data-name') || el.getAttribute('data-title') || el.id || '').trim();

  // Ø±Ø¨Ø· Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª
  paths.forEach(p=>{
    const key = getKey(p);
    if(!key) return;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ³Ù…ÙŠØ©
    const box = p.getBBox(), cx=box.x+box.width/2, cy=box.y+box.height/2;
    const adj = labelAdjust[key]||{};
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('class','region-label');
    label.setAttribute('text-anchor','middle');
    label.setAttribute('dominant-baseline','middle');
    label.setAttribute('x', cx+(adj.dx||0));
    label.setAttribute('y', cy+(adj.dy||0));
    const autoSize=Math.max(10,Math.min(18,box.width/18));
    label.style.fontSize=(autoSize+(adj.sizeAdd||0))+'px';
    if(typeof adj.rotate==='number'){
      label.setAttribute('transform',`rotate(${adj.rotate},${cx+(adj.dx||0)},${cy+(adj.dy||0)})`);
    }
    label.textContent = arabicLabels[key] || key;

    // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹Ù„Ù‰ iOS: Ø§ØªØ¬Ø§Ù‡/Ø¨Ø§ÙŠ-Ø¯Ø§ÙŠØ±ÙƒØ´Ù†/Ù„ÙŠØ¬ÙŠØªØ´Ø±Ø² + fallback Ø¹Ø±Ø¨ÙŠ
    label.setAttribute('direction','rtl');
    label.setAttribute('xml:lang','ar');
    label.setAttribute('lang','ar');
    label.style.direction = 'rtl';
    label.style.unicodeBidi = 'plaintext';   // Ø£Ùˆ 'isolate' Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
    label.style.fontVariantLigatures = 'contextual common-ligatures';
    label.style.fontFeatureSettings = "'liga' 1, 'calt' 1, 'rlig' 1";
    label.style.fontFamily = "Saudi, 'SF Arabic', 'Geeza Pro', Tahoma, Arial, sans-serif";
    label.style.letterSpacing = '0';
    label.style.wordSpacing = '0';
    // Ù…Ù†Ø¹ Ø£ÙŠ Ø­Ø¯ÙˆØ¯ Ù„Ù„Ù†Øµ
    label.setAttribute('stroke','none');
    label.style.stroke='none';
    label.style.webkitTextStroke='0';
    label.style.textShadow='none';
    label.style.paintOrder='fill';
    // Ù„Ø§ ØªØªÙ„Ù‚Ù‰ Ù„Ù…Ø³/Ù†Ù‚Ø±
    label.style.pointerEvents='none';

    labelLayer.appendChild(label);

    // Ø¥Ø¨Ø±Ø§Ø² Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ±
    let beforeHover = p.style.fill || p.getAttribute('fill') || '#ffffff';

    p.addEventListener('pointerenter', ()=>{
      if (hardLocked || (picked && key!==pickedRegionKey)) { p.style.cursor='default'; return; }
      beforeHover = p.style.fill || p.getAttribute('fill') || '#ffffff';
      p.style.fill = HOVER_FILL;
      p.style.stroke = '#0f172a';
      p.style.filter = 'drop-shadow(0 2px 3px rgba(0,0,0,.45))';
      p.style.cursor = 'pointer';
      if (p.parentNode) p.parentNode.appendChild(p);
    });

    p.addEventListener('pointerleave', ()=>{
      if (hardLocked || (picked && key!==pickedRegionKey)) return;
      p.style.fill = beforeHover;
      p.style.stroke = '#2b3a3a';
      p.style.filter = 'drop-shadow(0 1px 1px rgba(0,0,0,.35))';
    });

    // Ù…ÙØ¹Ù‘Ù„ Ù„ÙƒÙ„ Ù…Ù† click + pointerup + touchend (Ø£Ø¶Ù…Ù† Ù„Ù„Ø¬ÙˆØ§Ù„)
    const activate = (evt)=>{
      if (hardLocked) return;
      if (picked && key !== pickedRegionKey) return;

      if (!picked){
        picked = true;
        pickedRegionKey = key;
        paths.forEach(other=>{
          if (other !== p){
            other.style.pointerEvents='none';
            other.style.cursor='default';
          }
        });
      }
      openQuiz(key);
      if (evt) evt.preventDefault();
    };

    p.addEventListener('click', activate);
    p.addEventListener('pointerup', activate);
    p.addEventListener('touchend', activate, {passive:false});
  });

  // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ + Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© + Ù‚ÙÙ„ Ù†Ù‡Ø§Ø¦ÙŠ
  function openQuiz(regionKey){
    const data = regionQuiz[regionKey];
    const nice = arabicLabels[regionKey] || regionKey;
    if (!data){ note.textContent = `Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¤Ø§Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${nice}`; return; }

    let selectedIndex = null;

    note.innerHTML = `
      <div class="q-wrap" style="display:flex;flex-direction:column;gap:10px">
        <div class="q-text" style="font-weight:700">${nice}: ${data.q}</div>
        <div id="choices" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center"></div>
        <button id="submitAns" type="button"
          style="align-self:center;padding:8px 14px;border:none;border-radius:10px;background:#008847;color:#fff;font-weight:700;cursor:pointer">
          Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        </button>
      </div>
    `;

    const choicesWrap = note.querySelector('#choices');
    const submitBtn   = note.querySelector('#submitAns');

    data.choices.forEach((text,i)=>{
      const btn = document.createElement('button');
      btn.type='button'; btn.textContent=text;
      btn.style.cssText=`padding:10px 14px;border:2px solid #e5e7eb;border-radius:999px;background:#fff;cursor:pointer;transition:box-shadow .15s,border-color .15s,transform .05s`;
      btn.addEventListener('click', ()=>{
        [...choicesWrap.children].forEach(b=>{ b.style.borderColor='#e5e7eb'; b.style.boxShadow='none'; b.style.transform='none'; });
        btn.style.borderColor='#008847';
        btn.style.boxShadow='0 0 0 4px rgba(0,136,71,.18)';
        btn.style.transform='translateY(-1px)';
        selectedIndex = i;
      });
      choicesWrap.appendChild(btn);
    });

    submitBtn.addEventListener('click', ()=>{
      if (selectedIndex === null){
        note.querySelector('.q-text').textContent = 'Ø§Ø®ØªØ± Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„.';
        return;
      }
      const ok = (selectedIndex === data.correct);
      const resultColor = ok ? RIGHT_COLOR : WRONG_COLOR;

      paintAll(resultColor);

      const finishHTML = `
        <div style="font-weight:800;margin-bottom:6px">Ø¹Ø²Ù‘Ù†Ø§ Ø¨Ø·Ø¨Ø¹Ù†Ø§ âœ…</div>
        <div style="color:#0f172a;line-height:1.7">Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ÙÙŠ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ 95 ğŸ‰</div>
        <div style="color:#0f172a;line-height:1.7">ØªØ±Ù‚Ù‘Ø¨ Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„ÙØ§Ø¦Ø²ÙŠÙ† Ø¹Ø¨Ø± Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©.</div>
      `;

      try{
        localStorage.setItem('ndq-answered-once','1');
        localStorage.setItem('ndq-result-color', resultColor);
        localStorage.setItem('ndq-finish-note', finishHTML);
      }catch(_){}

      lockAll();
      note.innerHTML = finishHTML;
    }, { once:true });
  }

  // Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  if (isTest){
    const resetBtn = document.createElement('button');
    resetBtn.textContent = 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©';
    resetBtn.style.cssText = 'position:fixed;right:12px;bottom:12px;z-index:9999;background:#111827;color:#fff;padding:8px 12px;border:none;border-radius:10px;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,.2);';
    resetBtn.addEventListener('click', ()=>{
      ['ndq-answered-once','ndq-result-color','ndq-finish-note'].forEach(k=>localStorage.removeItem(k));
      hardLocked=false; picked=false; pickedRegionKey=null;
      location.reload();
    });
    document.body.appendChild(resetBtn);
  }
})();
</script>

</div>